<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <div class="row" style="width: 600px; margin-top: 100px;">
        <p>html5文件上传</p>
        <input type="file" name="file" id="file">
        <button>提交</button>
    </div>
<script type="text/javascript">
window.onload = function() {
    try {
        if (typeof XMLHttpRequest.prototype.sendAsBinary == 'undefined') {
            console.log("add sendAsBinary function");
            XMLHttpRequest.prototype.sendAsBinary = function(text){
                var data = new ArrayBuffer(text.length);
                var ui8a = new Uint8Array(data, 0);
                for (var i = 0; i < text.length; i++) ui8a[i] = (text.charCodeAt(i) & 0xff);
                this.send(ui8a);
            }
        }
    } catch (e) {
        console.log(e);
    }

    var fileEm = document.getElementById("file");
    fileEm.onchange = function() {
        console.log(this.files);
        console.log(this.files[0]);
        FileUpload(this.files[0]);
    };
    function FileUpload(file) {
        var reader = new FileReader();
        var xhr = new XMLHttpRequest();
        this.xhr = xhr;

        console.log("start upload!");
        xhr.upload.addEventListener("progress", function(e) {
            if (e.lengthComputable) {
                var percentage = Math.round((e.loaded * 100) / e.total);
                console.log(percentage);
            }
        }, false);

        xhr.upload.addEventListener("load", function(e) {
            console.log("file load done!");
        }, false);

        xhr.open("POST", "my server url");
        xhr.overrideMimeType('text/plain; charset=x-user-defined-binary');
        reader.onload = function(evt) {
            xhr.sendAsBinary(evt.target.result);
        };
        reader.readAsBinaryString(file);
    }


};
</script>
</body>
</html>